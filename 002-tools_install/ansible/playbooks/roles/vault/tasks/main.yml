# - name: installing hashicorp "{{ toolname }}"
#   ansible.builtin.shell: set-hostname "{{ toolname }}"

# - name: install yum utils
#   ansible.builtin.shell:  yum install -y yum-utils

# - name: adding repo
#   shell: yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo

# - name: install yum
#   ansible.builtin.yum: 
#     name: "{{ toolname }}"
#     state: present

# - name: Start service vault
#   ansible.builtin.service:
#     name: "{{ toolname }}"
#     enabled: yes
#     state: started
  
# - name: Validate toolname is set
#   assert:
#     that:
#       - toolname is defined
#       - toolname | length > 0
#     fail_msg: "toolname variable is missing or empty"

# - name: Set hostname
#   become: false
#   ansible.builtin.raw: |
#     hostnamectl set-hostname "{{ toolname }}"


# - name: Install yum utils
#   ansible.builtin.yum:
#     name: yum-utils
#     state: present
  

# - name: Add HashiCorp repo
#   ansible.builtin.command:
#     cmd: yum-config-manager --add-repo https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo
#   args:
#     creates: /etc/yum.repos.d/hashicorp.repo
#   become: true

# - name: Install Vault
#   ansible.builtin.yum:
#     name: "{{ toolname }}"
#     state: present
#   become: true

# - name: Start Vault service
#   ansible.builtin.service:
#     name: "{{ toolname }}"
#     enabled: true
#     state: started
#   become: true

#### Latest code from chatGpt

- name: Validate toolname is set
  ansible.builtin.assert:
    that:
      - toolname is defined
      - toolname is not none
      - toolname | trim | length > 0
    fail_msg: "toolname variable is missing or empty"

# - name: Set hostname
#   ansible.builtin.hostname:
#     name: "{{ toolname }}"

# - name: Install required system utilities
#   ansible.builtin.dnf:
#     name: dnf-utils
#     state: present


- name: Set hostname {{ toolname }}
  ansible.builtin.raw: sudo hostnamectl set-hostname vault

- name: Install yum utils
  ansible.builtin.raw: dnf install -y yum-utils

- name: Add HashiCorp repository
  ansible.builtin.raw: |
    if [ ! -f /etc/yum.repos.d/hashicorp.repo ]; then
      curl -fsSL https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo \
        -o /etc/yum.repos.d/hashicorp.repo

- name: Add HashiCorp repository
  ansible.builtin.get_url:
    url: https://rpm.releases.hashicorp.com/RHEL/hashicorp.repo
    dest: /etc/yum.repos.d/hashicorp.repo
    mode: '0644'

- name: Install {{ toolname }}
  ansible.builtin.dnf:
    name: "{{ toolname }}"
    state: present

- name: Enable and start {{ toolname }} service
  ansible.builtin.service:
    name: "{{ toolname }}"
    enabled: true
    state: started